---
- name: Install Argo CD on Kubernetes master
  hosts: master
  become: yes

  tasks:
    - name: Create the ArgoCD namespace
      kubernetes.core.k8s:
        api_version: v1
        kind: Namespace
        name: argocd
    - name: Install Argo CD using kubectl
      shell: kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
      register: argocd_install_result
      changed_when: false

    - name: Print installation result
      debug:
        var: argocd_install_result.stdout_lines
        
    - name: Get ArgoCD initial admin password
      shell: |
        kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d
      register: admin_password
    - name: Display the ArgoCD admin password
      debug:
        msg: "The ArgoCD admin password is {{ admin_password.stdout }}"
